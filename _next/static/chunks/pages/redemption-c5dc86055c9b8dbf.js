(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[513],{42798:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/redemption",function(){return c(46695)}])},46695:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return ab}});var d=c(85893),e=c(47568),f=c(34051),g=c.n(f),h=c(67294),i=c(77058),j=function(a){var b=a.isActive,c=a.type,e=a.handleClick,f=(0,i.$)().t;return(0,d.jsx)("button",{className:b?"nav-link active":"nav-link","data-bs-toggle":"pill",onClick:function(){return e(c)},children:f(c)})},k=function(a){var b=a.type,c=a.handleClick;return(0,d.jsx)("div",{className:"card-borrow-tab",children:(0,d.jsx)("div",{className:"dchf-pills",children:(0,d.jsxs)("div",{className:"nav-pills",role:"tablist",children:[(0,d.jsx)(j,{isActive:b==X.eth,type:"eth",handleClick:c}),(0,d.jsx)(j,{isActive:b==X.wbtc,type:"wbtc",handleClick:c})]})})})},l=k,m=c(26042),n=c(21043),o=c(57345),p=c(13499),q=c(16766),r=c(84531),s=c(43335),t=c(20701),u=c(10253),v=c(2593),w=c(35553),x=c(64487),y=c(9669),z=c.n(y),A=c(9279),B=c(5324),C=c(5313),D=A.d,E=function(a){return B.tA.fromBigNumberString(a.toHexString())};function F(a,b,c){return G.apply(this,arguments)}function G(){return(G=(0,e.Z)(g().mark(function a(b,c,d){var e,f,h,i,j,k,l,m;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,c.priceFeed.getDirectPrice(d);case 3:return e=a.sent,a.next=6,c.hintHelpers.getRedemptionHints(d,b.hex,e,50);case 6:if(h=(f=a.sent).firstRedemptionHint,i=f.partialRedemptionHintNICR,j=f.truncatedDCHFamount,!i.isZero()){a.next=14;break}a.t0={lower:D,upper:D},a.next=17;break;case 14:return a.next=16,(0,C.o)(c,E(i),d);case 16:a.t0=a.sent;case 17:return l=(k=a.t0).lower,m=k.upper,a.abrupt("return",[E(j),h,m,l,i]);case 23:return a.prev=23,a.t1=a.catch(0),console.error(a.t1),a.abrupt("return",[E((0,q.Md)("0")),"","","",(0,q.Md)("0")]);case 27:case"end":return a.stop()}},a,null,[[0,23]])}))).apply(this,arguments)}var H=v.O$.from("0");function I(a,b,c,d){return J.apply(this,arguments)}function J(){return(J=(0,e.Z)(g().mark(function a(b,c,d,e){var f,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return h=c[f=d==X.eth?"ETH":"renBTC"],a.prev=2,a.next=6,Promise.all([b.DCHFToken.balanceOf(e),z().get("https://dev-api.defifranc.com/current-data/price/dchf"),z().get("https://dev-api.defifranc.com/historical-data/price?from=USD&to=CHF"),b.troveManagerHelpers.getRedemptionRateWithDecay(h),b.priceFeed.getDirectPrice(h),]);case 6:return j=a.sent,l=(k=(0,u.Z)(j,5))[0],m=k[1],n=m.data,o=k[2],p=o.data,q=k[3],r=k[4],t=1/(s=(null==p?void 0:null===(i=p[(null==p?void 0:p.length)-1])|| void 0===i?void 0:i.value)||1),v=null==n?void 0:n.value,a.next=13,b.troveManagerHelpers.getTCR(h,r);case 13:return w=a.sent,a.abrupt("return",{userBalance:l,dchfPrice:{usd:t,chf:v},assetPrice:r,redemptionRate:q,redemptionFee:H,tcr:w});case 17:return a.prev=17,a.t0=a.catch(2),console.error("Fetch Redemption Data error ->",a.t0),x.Tb(a.t0),a.abrupt("return",Y);case 22:case"end":return a.stop()}},a,null,[[2,17]])}))).apply(this,arguments)}function K(a,b,c){return L.apply(this,arguments)}function L(){return(L=(0,e.Z)(g().mark(function a(b,c,d){var e,f,h,i,j,k,l,m,n;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=(0,q.Md)((0,q.AY)(.005*1e18)),f=(0,q.Md)((0,q.AY)(.02*1e18)),h=(0,q.Md)("2"),a.t0=u.Z,a.next=6,Promise.all([b.troveManagerHelpers.getRedemptionRateWithDecay(c),b.DCHFToken.totalSupply(),]);case 6:return a.t1=a.sent,j=(i=(0,a.t0)(a.t1,2))[0],k=i[1],l=d.div(k),m=l.div(h).add(j),n=e.add(m).add(f),a.abrupt("return",n);case 14:case"end":return a.stop()}},a)}))).apply(this,arguments)}function M(a,b,c,d,e){return N.apply(this,arguments)}function N(){return(N=(0,e.Z)(g().mark(function a(b,c,d,e,f){var h,i,j,k,l,m,n,o,p,r,s,t,v;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return h=w.fi(d),i=e?c.ETH:c.renBTC,j=B.tA.fromBigNumberString(h.toString()),a.prev=3,f("loading-transaction"),a.next=7,K(b,i,(0,q.Md)((0,q.AY)(1e18*+h)));case 7:return k=a.sent,a.t0=u.Z,a.next=11,F(j,b,i);case 11:return a.t1=a.sent,m=(l=(0,a.t0)(a.t1,5))[0],n=l[1],o=l[2],p=l[3],r=l[4],console.log({asset:i,truncatedDCHFamount:m.hex,firstRedemptionHint:n,upper:o,lower:p,partialRedemptionHintNICR:r,_redeemMaxIterations:50,redemptionRate:k}),a.next=21,b.troveManager.estimateGas.redeemCollateral(i,m.hex,n,o,p,r,50,k);case 21:return t=(s=a.sent).mul((0,q.Md)("12")).div((0,q.Md)("10")),a.next=25,b.troveManager.redeemCollateral(i,m.hex,n,o,p,r,50,k,{gasLimit:t});case 25:return v=a.sent,a.next=28,v.wait();case 28:return f("success"),a.abrupt("return",!0);case 32:return a.prev=32,a.t2=a.catch(3),f("error"),x.Tb(a.t2),a.abrupt("return",!1);case 37:case"end":return a.stop()}},a,null,[[3,32]])}))).apply(this,arguments)}var O={isApproveLoading:!1,isActionLoading:!1,isSuccess:!1,isError:!1},P=function(a){var b=a.isETH,c=a.userBalance,f=a.setForceRefresh,j=a.isBlocked,k=a.setInputAmount,l=a.inputAmount,u=a.dchfPrice,v=function(a){D(O),k(a)},w=(0,i.$)().t,x=(0,o.C)(p.D0),y=(0,n.G)(),z=y.contracts,A=y.addresses,B=(0,h.useState)(O),C=B[0],D=B[1];function E(a){return F.apply(this,arguments)}function F(){return(F=(0,e.Z)(g().mark(function a(b){var c;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=(0,m.Z)({},O),"loading-approve"===b&&(c.isApproveLoading=!0),"loading-transaction"===b&&(c.isActionLoading=!0),"success"===b&&(c.isSuccess=!0),"error"===b&&(c.isError=!0),D(c);case 6:case"end":return a.stop()}},a)}))).apply(this,arguments)}function G(){return(G=(0,e.Z)(g().mark(function a(){var c;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(x){a.next=2;break}return a.abrupt("return",null);case 2:return a.next=4,M(z,A,l,b,E);case 4:(c=a.sent)&&(f(!0),k(""));case 6:case"end":return a.stop()}},a)}))).apply(this,arguments)}var H,I,J,K,L,N,P,Q=C.isActionLoading||C.isApproveLoading,R=(H=C,I=b,J=H.isApproveLoading,K=H.isActionLoading,L=H.isSuccess,J?"Approving Redeem...":K?I?"Redeeming ETH...":"Redeeming wBTC....":L?"Success":"Redeem"),S=(0,q.uf)(c),T=u.chf-1>0,U=(N=l,1e18*+N> +(P=c)?"You don't have enough DCHF!":"");return(0,d.jsxs)("div",{className:"card-stake-form",children:[j&&(0,d.jsx)("div",{style:{color:"#bf1304",margin:"0 0 1rem 0",textAlign:"center"},children:(0,d.jsx)("b",{children:"You can't redeem DCHF when the total collateral ratio is less than 110% . Please try again later."})}),(0,d.jsxs)("div",{className:"dchf-form",children:[(0,d.jsx)("label",{children:"Redeem ".concat(w(b?"eth":"btc"))}),(0,d.jsxs)("div",{className:"dchf-form-wrap",children:[(0,d.jsx)(r.Z,{type:"number",value:l,placeholder:0,onChange:function(a){return v(a.target.value)}}),(0,d.jsxs)("div",{className:"dchf-form-info",children:[(0,d.jsx)(s.d,{value:S,symbol:"DCHF",text:w("wallet"),onClick:function(){return v(S)}}),(0,d.jsx)("div",{className:"dchf-form-info-icon",children:(0,d.jsx)("img",{src:"img/general/dchf-icon.svg",alt:"icon"})})]})]}),U&&(0,d.jsx)("div",{style:{color:"#bf1304",margin:"8px 0"},children:(0,d.jsx)("b",{children:U})})]}),(0,d.jsx)("button",{className:"button button-primary",onClick:function(){return G.apply(this,arguments)},disabled:j||!(+l>0),style:T?{opacity:.4}:{},children:(0,d.jsxs)("div",{className:"confirmButtonMainWrapper",children:[(0,d.jsx)("div",{className:"selfCenter widthThirtyThree",children:R}),Q&&(0,d.jsx)("div",{className:"spinnerWrapper",children:(0,d.jsx)(t.ZP,{})})]})}),C.isError&&(0,d.jsx)("div",{className:"selfCenter",style:{color:"#bf1304",margin:"8px 0"},children:(0,d.jsxs)("b",{children:[" ",w("somethingWentWrong")]})})]})},Q=c(80069),R=function(a){var b=a.isEth;return(0,d.jsx)("div",{className:"card-redemption-images",children:(0,d.jsx)("div",{className:"card-redemption-images",children:(0,d.jsx)("div",{className:"card-redemption-images-wrap",children:(0,d.jsx)("img",{src:b?"img/general/redemption-eth.png":"img/general/redemption-btc.png",alt:"eth",className:"img-fluid"})})})})},S=c(85770),T=c(21046),U=c(41664),V=c.n(U),W=c(65310),X={eth:"eth",wbtc:"wbtc"},Y={userBalance:(0,q.Md)("0"),dchfPrice:{usd:0,chf:0},assetPrice:(0,q.Md)("1"),redemptionFee:(0,q.Md)("0"),redemptionRate:(0,q.Md)("0"),tcr:(0,q.Md)("0")},Z=function(a){var b=a.dchfPrice,c=a.received,e=a.asset,f=a.fee,g=(0,h.useContext)(W.t),j=(0,i.$)().t,k=(0,Q.x)(+c/1e18,4),l=b.chf-1;return(0,d.jsxs)("div",{className:"info-sidebar-section",children:[(0,d.jsx)(S.M$,{title:j("rewards")}),(0,d.jsx)(S.X8,{title:"DCHF Price",value:"".concat((0,Q.x)(b.chf)," CHF")}),(0,d.jsx)(S.X8,{title:"CHF Price",value:"".concat((0,Q.x)(b.usd)," USD")}),(0,d.jsx)(S.X8,{title:"Redemption Fee",value:"".concat((0,Q.x)(+f/1e16),"%"),toolTip:"This is paid when you redeem your dchf for the specific Collateral Asset"}),(0,d.jsx)(S.X8,{title:"Receive",value:"".concat(k," ").concat(j(e))}),l>0&&(0,d.jsx)("div",{className:"header-price-item",style:{background:"#ff333333",borderColor:"#FF3232",height:"fit-content"},children:(0,d.jsx)("a",{children:(0,d.jsxs)("p",{style:{color:"#FF3232",fontWeight:"bold",padding:"0 1rem",lineHeight:"1.5"},children:["DCHF is currently trading above the CHF price. You would"," ",(0,d.jsxs)("b",{children:["loose ",(0,Q.x)(100*l),"% "]}),"now by redeeming DCHF. If you want to pay back your loan please go to the"," ",(0,d.jsx)(V(),{href:"/borrow",children:(0,d.jsx)("a",{style:{textDecoration:"underline"},children:"Borrow Tab."})})," ","If you want to get rid of your"," ",(0,d.jsx)("span",{style:{textDecoration:"underline",cursor:"pointer"},onClick:function(){return null==g?void 0:g.handleOpenBuyModal()},children:"DCHF sell"})," ","instead to make a profit"]})})})]})},$=function(){var a=(0,i.$)().t,b=(0,o.C)(p.D0),c=(0,h.useState)(Y),f=c[0],j=c[1],k=(0,h.useState)(!1),m=k[0],r=k[1],s=(0,h.useState)("-"),t=s[0],u=s[1],v=(0,h.useState)("eth"),w=v[0],x=v[1],y=(0,n.G)(),z=y.contracts,A=y.addresses,B=function(a){if(a===w)return x("eth");x(a),u("-")};function C(){return D.apply(this,arguments)}function D(){return(D=(0,e.Z)(g().mark(function a(){var c;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b){a.next=2;break}return a.abrupt("return",null);case 2:return a.next=4,I(z,A,w,b);case 4:(c=a.sent)&&j(c);case 6:case"end":return a.stop()}},a)}))).apply(this,arguments)}(0,h.useEffect)(function(){b&&C()},[b]),(0,h.useEffect)(function(){b&&C()},[w]),(0,h.useEffect)(function(){m&&(C(),r(!1))},[m]);var E=w===X.eth,F=+f.tcr>0&& +f.tcr/1e18<=1.1,G=f.assetPrice,H=(0,q.Md)((0,q.AY)(1e18*+t)).mul(f.redemptionRate).div(f.assetPrice),J=+G>1?(0,q.Md)((0,q.AY)(1e18*+t)).mul(T.Ce).div(f.assetPrice).sub(H):(0,q.Md)("0");return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"row",children:(0,d.jsx)("div",{className:"col-md-12 col-lg-12",children:(0,d.jsx)("div",{className:"dchf-content",children:(0,d.jsxs)("p",{children:[a("redemptionDescription")," ",(0,d.jsxs)("span",{children:["Learn more,"," ",(0,d.jsx)("a",{href:"https://docs.defifranc.com/in-depth/price-stability-and-redemptions",target:"_blank",rel:"noreferrer",style:{marginLeft:"4px"},children:"Read our Documentation"})]})]})})})}),(0,d.jsx)("div",{className:"row justify-content-center",children:(0,d.jsx)("div",{className:"col-lg-10 col-xl-11 col-xxl-10",children:(0,d.jsxs)("div",{className:"card card-borrow",children:[(0,d.jsx)("div",{className:"card-borrow-left",children:(0,d.jsx)("div",{className:"row",children:(0,d.jsxs)("div",{className:"col-lg-12 col-xl-12 col-xxl-12",children:[(0,d.jsx)(R,{isEth:E}),(0,d.jsx)(l,{type:w,handleClick:B}),(0,d.jsx)(P,{isETH:E,userBalance:f.userBalance,setForceRefresh:r,isBlocked:F,setInputAmount:u,inputAmount:t,dchfPrice:f.dchfPrice})]})})}),(0,d.jsx)("div",{className:"card-borrow-right",children:(0,d.jsx)(Z,{received:J,dchfPrice:f.dchfPrice,asset:w,fee:f.redemptionRate})})]})})})]})},_=$,aa=function(){return(0,d.jsx)(_,{})},ab=aa}},function(a){a.O(0,[193,335,774,888,179],function(){var b;return a(a.s=42798)}),_N_E=a.O()}])